{"version":3,"sources":["auth.js","post.js","comment.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"scripts.js","sourcesContent":["/*eslint-disable no-undef */\r\n$(function(){\r\nvar flag = true;\r\n$('.switch-button').on('click',function(e){\r\n    e.preventDefault();\r\n    removeSuccess();\r\n    $('.auth input').val('');\r\n    if(flag){\r\n        flag =false;\r\n        $('.register').show('slow');\r\n        $('.login').hide();\r\n    }else{\r\n        flag = true;\r\n        $('.login').show('slow');\r\n        $('.register').hide();\r\n    }\r\n});\r\n \r\n//clear styles\r\n$('form.login input, form.register input').on('focus', function(){\r\n   removeError();\r\n})\r\n\r\n//register\r\n$('.register-button').on('click',function(e){\r\n    e.preventDefault();\r\n    removeSuccess();\r\n    var data ={\r\n        login:$('#register-login').val(),\r\n        password:$('#register-password').val(),\r\n        passwordConfirm: $('#register-password-confirm').val()\r\n    };\r\n    $.ajax({\r\n        type:'POST',\r\n        data: JSON.stringify(data),\r\n        contentType:'application/json',\r\n        url:'/api/auth/register'\r\n    }).done(function(data){\r\n        if(!data.ok){\r\n            $('.register h2').after('<p class=\"error\">' + data.error + '</p>');\r\n            if(data.fields){\r\n                data.fields.forEach(function(item){\r\n                    $('input[name='+item+']').addClass('error');\r\n                })\r\n            }\r\n        } else{\r\n            $('.register h2').after('<p class=\"success\">Отлично! </p>');\r\n            $(location).attr('href', '/');\r\n        }\r\n    });\r\n});\r\n\r\n//login\r\n$('.login-button').on('click',function(e){\r\n    e.preventDefault();\r\n    var data ={\r\n        login:$('#login-login').val(),\r\n        password:$('#login-password').val(),\r\n    };\r\n    $.ajax({\r\n        type:'POST',\r\n        data: JSON.stringify(data),\r\n        contentType:'application/json',\r\n        url:'/api/auth/login'\r\n    }).done(function(data){\r\n        if(!data.ok){\r\n            $('.login h2').after('<p class=\"error\">' + data.error + '</p>');\r\n            if(data.fields){\r\n                data.fields.forEach(function(item){\r\n                    $('input[name='+item+']').addClass('error');\r\n                })\r\n            }\r\n        } else{\r\n            $('.login h2').after('<p class=\"success\">Отлично! </p>');\r\n            $(location).attr('href', '/');\r\n\r\n        }\r\n    });\r\n});\r\nfunction removeSuccess(){\r\n    if($('.register').has('p.success')){\r\n        $('p.success').remove();\r\n    }\r\n    if($('.register').has('p.error')){\r\n        $('p.error').remove();\r\n        $('input').removeClass('error');\r\n    }\r\n}\r\nfunction removeError(){\r\n    $('.auth p.error').remove();\r\n    $('.register input, .login input').removeClass('error');\r\n}\r\n});\r\n/*eslint-unable no-undef */\r\n","/*eslint-disable no-undef */\r\n$(function(){\r\n\r\n //clear styles\r\n$('.post-form input, #post-body').on('focus', function(){\r\n    $('.add-post p.error').remove();\r\n    $('.post-form #post-body, .post-form input').removeClass('error');\r\n })\r\n \r\n //publish\r\n $('.publish-button, .save-button').on('click', function(e){\r\n    e.preventDefault();\r\n   \r\n     var isDraft = \r\n     $(this)\r\n     .attr('class')\r\n     .split(' ')[0] === 'save-button';\r\n     \r\n    var data ={\r\n        title:$('#post-title').val(),\r\n        body: $('#post-body').val(),\r\n        isDraft: isDraft,\r\n        postId:$('#post-id').val()\r\n    };\r\n     $.ajax({\r\n         type:'POST',\r\n         data: JSON.stringify(data),\r\n         contentType:'application/json',\r\n         url:'/post/add'\r\n     }).done(function(data){\r\n         console.log(data);\r\n         if(!data.ok){\r\n         $('.post-form h2').after('<p class=\"error\">' + data.error + '</p>');\r\n         if(data.fields){\r\n              data.fields.forEach(function(item){\r\n                  $('#post-'+item).addClass('error');\r\n              })\r\n            }\r\n        } else {\r\n             if(isDraft){\r\n                $(location).attr('href', '/post/edit/'+ data.post.id);\r\n             }else{\r\n                $(location).attr('href','/posts/'+data.post.url);\r\n             }\r\n             // $('.register h2').after('<p class=\"success\">Отлично! </p>');\r\n             // $(location).attr('href', '/');\r\n         }\r\n     });\r\n });\r\n\r\n //upload\r\n  $('#file').on('change', function(e){\r\n    //  e.preventDefault();\r\n      var formData = new FormData();\r\n      formData.append('postId',$('#post-id').val());\r\n      formData.append('file',$('#file')[0].files[0]);\r\n      console.log(formData)\r\n      \r\n      $.ajax({\r\n          type:'POST',\r\n          url:'/upload/image',\r\n          data: formData,\r\n          processData: false,\r\n          contentType: false,\r\n          success: function(data){\r\n              console.log(data);\r\n              $('#fileinfo').prepend('<div class=\"img-container\"><img src=\"/uploads'+data.filePath+'\" alt=\"\"></div>')\r\n          },\r\n          error: function(e){\r\n              console.log(e);\r\n          }\r\n      })\r\n  })\r\n  //inserting image\r\n  $('.img-container').on('click', function(){\r\n      var imageId = $(this).attr('id');\r\n      var txt = $('#post-body');\r\n      var caretPos= txt[0].selectionStart;\r\n      var textAreaTxt = txt.val();\r\n      var txtToAdd = '![alt text](image'+imageId+')';\r\n      txt.val(textAreaTxt.substring(0, caretPos)+txtToAdd + textAreaTxt.substring(caretPos));\r\n  })\r\n\r\n});\r\n/*eslint-unable no-undef */\r\n","$(function(){\r\n  var commentForm;\r\n  var parentId;\r\n\r\n   function form (isNew, comment){\r\n     $('.reply').show();\r\n     if(commentForm){\r\n         commentForm.remove();\r\n     }\r\n     parentId =null;\r\n     commentForm = $('form.comment').clone(true,true)\r\n     if(isNew){\r\n         commentForm.find('.cancel').hide();\r\n         commentForm.prependTo('.comment-list');\r\n         commentForm.addClass('default');\r\n     }else{\r\n         var parentComment = $(comment).parent();\r\n         parentId =parentComment.attr('id');\r\n         commentForm.addClass('for_reply');\r\n         $(comment).after(commentForm);\r\n     }\r\n     commentForm.css({display:'flex'})\r\n   }\r\n   //load\r\n   form(true);\r\n   //reply\r\n   $('.reply').on('click',function(e){\r\n         form(false,this);\r\n         $(this).hide();\r\n   })  \r\n\r\n  // add form\r\n//  $('#new, #reply').on('click', function() {\r\n//     if (commentForm) {\r\n//       commentForm.remove();\r\n//     }\r\n//    parentId = null;\r\n//\r\n//    commentForm = $('.comment').clone(true, true);\r\n//\r\n//    if ($(this).attr('id') === 'new') {\r\n//      commentForm.appendTo('.comment-list');\r\n//    } else {\r\n//      var parentComment = $(this).parent();\r\n//      parentId = parentComment.attr('id');\r\n//      $(this).after(commentForm);\r\n//    }\r\n//\r\n//    commentForm.css({ display: 'flex' });\r\n//  });\r\n//\r\n \r\n  //cancel\r\n  $('form.comment .cancel').on('click',function(e){\r\n      e.preventDefault();\r\n      commentForm.remove();\r\n      form(true);     \r\n  })\r\n \r\n  //publish\r\n  $('form.comment .send').on('click',function(e){\r\n     e.preventDefault();\r\n    \r\n    var data ={\r\n        post : $('.comments').attr('id'),\r\n        body:commentForm.find('textarea').val(),\r\n        parent: parentId\r\n    }, el =$(this).closest('form')[0],\r\n    cl=$(el).attr('class').split(' ')[1];\r\n console.log('.'+cl+' .body')\r\n    $.ajax({\r\n        type:'POST',\r\n        data: JSON.stringify(data),\r\n        contentType:'application/json',\r\n        url:'/comment/add'\r\n    }).done(function(data){\r\n        if(!data.ok){\r\n         $(el).before('<p class=\"error\">' + data.error + '</p>');\r\n         if(data.fields){\r\n             data.fields.forEach(function(item){\r\n                 $('.'+cl+' .'+item).addClass('error');\r\n             })\r\n          }\r\n            //clear styles\r\n           $('.body').on('focus', function(e){\r\n             $(this).closest('form').prev().remove();\r\n             $('.body').removeClass('error');\r\n           });\r\n \r\n        } else{\r\n           var newComment ='<ul><li style=\"background-color:#ffffe0;\"><div class=\"head\"><a href=\"/users/'+data.login+'\">'+data.login+'</a><span class=\"date\">Только что</span></div><p>'+data.body+'</p></li></ul>';\r\n           $(commentForm).after(newComment);\r\n           form(true);\r\n           \r\n     //  location.reload();\r\n        }\r\n    });\r\n  });\r\n  \r\n\r\n   //delete \r\n   $('button.head-delete').on('click', function(e){\r\n    var a =this.parentNode.parentElement,\r\n      data ={\r\n      commentId : a.getAttribute('id')\r\n    // parent: a.parentNode.parentNode.getAttribute('id')\r\n    };\r\n      $.ajax({\r\n      type:'POST',\r\n      data: JSON.stringify(data),\r\n      contentType:'application/json',\r\n      url:'/comment/delete'\r\n      }).done(function(data){\r\n        if(!data.ok){\r\n          console.log(data)\r\n        }else{\r\n        //  $(location).attr({href: '/'});\r\n        location.reload();\r\n        }\r\n      });\r\n   })\r\n});"]}